---
import type { ButtonProps } from "@/components/primitives/Button.astro";
import Container from "@/components/primitives/Container.astro";
import Link from "@/components/primitives/Link.astro";
import Blob from "@/components/sections/Blob.astro";
import Countdown from "@/components/primitives/Countdown.astro";


interface Props {
    headline?: string;
    title: string;
    subtitle: string;
    buttons?: ButtonProps[];
    eventDate?: string;
}

const defaultButtons: ButtonProps[] = [
    {
        title: "Contattaci",
        href: "/contact",
        style: "button",
        icon: "iconamoon:arrow-top-right-1-thin",
    },
];

const defaultEventDate = "2025-08-28T09:00:00";
const { headline = "",title, subtitle, buttons = defaultButtons, eventDate = defaultEventDate } = Astro.props;

---

<div
    id="hero"
    class="items-center text-sm font-medium justify-center pb-48 lg:px-20 pt-32 lg:pt-44 relative flex min-h-[100svh] bg-[#F7F7F7]"
>
    <Container>
        <div class="items-center flex-col w-full m-auto">
            <div class="text-center max-w-5xl mx-auto mb-16">
                
                {headline && 
                    <h1
                        data-hero-reveal
                        class="headline text-4xl md:text-6xl lg:text-7xl leading-tight mb-2 font-extrabold text-[#2C3E50]"
                    >
                        {headline}
                    </h1>
                }
                <h2
                    data-hero-reveal
                    class="title text-2xl md:text-3xl lg:text-4xl leading-tight mt-2 mb-6 font-bold text-[#1A7A64]"
                    set:html={title}
                />
                <p
                    data-hero-reveal
                    class="text-xl md:text-2xl font-semibold mb-10 max-w-4xl mx-auto text-[#0D3B66]"
                    set:html={subtitle}
                />

                <Countdown eventDate={eventDate} />
                <div class="mt-10 text-white flex justify-center gap-4">
                    {
                        buttons.map(({ title, href, style, icon }) => (
                            <Link
                                data-hero-reveal
                                href={href}
                                class="register-button bg-[#1A7A64] hover:bg-[#0D3B66] text-white font-medium py-3 px-6 rounded-md transition-all duration-300 flex items-center gap-2 shadow-md hover:shadow-lg hover:transform hover:translate-y-[-2px]"

                                style={
                                    style as
                                        | "primary"
                                        | "button"
                                        | "outline"
                                        | "buttonLight"
                                }
                                icon={icon}
                            >
                                {title}
                            </Link>
                        ))
                    }
                </div>
            </div>
            <div class="mt-12 flex justify-center">
                <Blob class="max-w-full" />
            </div>
        </div>
        <div
            class="items-center bottom-[3.13rem] justify-center left-0 absolute right-0 z-10 flex max-w-[80%] overflow-hidden m-auto text-blue-700"
        >
            <div class="items-center flex">
                <button
                    id="scroll-down-button"
                    class="scroll-down-button items-start justify-center underline flex w-5 h-7 max-w-full border-2 border-black border-solid rounded-xl m-auto"
                    ><div class="bg-black cursor-pointer w-0.5 h-1 mt-1.5">
                    </div>
                </button>
            </div>
        </div>
    </Container>
</div>

<style>
    @keyframes moveDown {
        0% {
            transform: translateY(0);
        }
        80% {
            transform: translateY(2px);
        }
        100% {
            transform: translateY(0);
        }
    }

    .scroll-down-button:hover div {
        animation: moveDown 0.7s infinite;
    }
    [data-hero-reveal] {
        opacity: 0;
        filter: blur(3px);
    }

    .headline {
        background: linear-gradient(90deg, #1A7A64 0%, #0D3B66 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        margin-bottom: 1rem;
    }

    /* Style for the title text */
    .title {
        font-weight: 700;
        letter-spacing: -0.02em;
        margin-bottom: 1.5rem;
    }


    h2 b {
        color: #1A7A64; /* Primary teal green */
        position: relative;
        display: inline-block;
        padding: 0 3px;
    }
    h1 b::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 100%;
        height: 3px;
        background-color: #4ECDC4; /* Accent teal */
        transform: scaleX(0);
        transition: transform 0.4s ease;
        transform-origin: bottom right;
    }

    h1:hover b::after {
        transform: scaleX(1);
        transform-origin: bottom left;
    }

    .register-button:focus {
        outline: 2px solid #4ECDC4;
        outline-offset: 2px;
    }
    
    /* Add a highlight effect for the icon */
    .register-button svg {
        transition: transform 0.3s ease;
        color: #FF9F1C; /* Warning/highlight color */
    }
    
    .register-button:hover svg {
        transform: translateX(2px) translateY(-2px);
    }
</style>

<script>
    import { gsap } from "gsap";
    import { ScrollToPlugin } from "gsap/ScrollToPlugin";
    import { BlurPlugin } from "@/utils/gsap-blur";
    import { LifecycleManager } from "@/utils/lifecycle-manager";

    gsap.registerPlugin(ScrollToPlugin, BlurPlugin);

    const lm = new LifecycleManager();

    function scrollDown() {
        gsap.to(window, { duration: 0.5, scrollTo: "#services" });
    }

    lm.onElementLoaded("hero", (ctx) => {
        ctx?.add(() => {
            const scrollDownButton =
                document.getElementById("scroll-down-button");
            scrollDownButton?.addEventListener("click", scrollDown);

            gsap.to("[data-hero-reveal]", {
                blur: 0,
                delay: 0.2,
                duration: 1.2,
                opacity: 1,
                stagger: 0.15
            });
        });
    });
</script>
