---
interface CommitteeMember {
    name: string;
    title?: string;
    affiliation?: string;
    role?: string;
    image?: string;
    country?: string;
    email?: string;
    category?: string; // For grouping members (e.g., "Chair", "Co-Chair", "Technical Committee", etc.)
}

interface Props {
    title: string;
    subtitle?: string;
    description?: string;
    members: CommitteeMember[];
}

const { title, subtitle, description, members } = Astro.props;

// Group members by their category
const groupedMembers = members.reduce((acc, member) => {
    const category = member.category || 'Committee Members';
    if (!acc[category]) {
        acc[category] = [];
    }
    acc[category].push(member);
    return acc;
}, {} as Record<string, CommitteeMember[]>);

// Order for the categories (you can adjust as needed)
const categoryOrder = [
    'Conference Chair',
    'Conference Co-Chairs',
    'Organizing Committee',
    'Technical Committee',
    'Scientific Committee',
    'Advisory Committee',
    'Committee Members'
];

// Sort the categories
const sortedCategories = Object.keys(groupedMembers).sort((a, b) => {
    const indexA = categoryOrder.indexOf(a);
    const indexB = categoryOrder.indexOf(b);
    return (indexA === -1 ? 999 : indexA) - (indexB === -1 ? 999 : indexB);
});

// Default avatar placeholder
const defaultAvatar = "/src/assets/committee/Ms.-J.-Kirushika.jpg";

// Check if the image path exists
const imageExists = (image: string) => {
    if (!image) return false;
    // This is a simple check, in a real-world environment you'd want to ensure the file exists
    return true;
}
---

<section class="py-20 bg-gradient-to-b from-white to-slate-50">
    <div class="container mx-auto px-4">
        <div class="text-center mb-16">
            <h2 class="text-[2.13rem] leading-9 font-semibold mb-6 text-[#2C3E50]">{title}</h2>

            <!-- Decorative divider line with gradient -->
            <div class="w-32 h-1 bg-gradient-to-r from-[#1A7A64] to-[#4ECDC4] rounded-full mx-auto mb-6"></div>

            {subtitle &&
                <p class="text-xl text-[#2C3E50]/80 mb-4 font-medium">{subtitle}</p>
            }

            {description &&
                <p class="max-w-3xl mx-auto text-[#2C3E50]/70 leading-relaxed">{description}</p>
            }

            <!-- Decorative elements -->
            <div class="relative mt-8 mb-12">
                <div class="absolute left-1/2 -translate-x-1/2 top-0 w-16 h-8">
                    <div class="absolute left-0 top-0 w-2 h-2 rounded-full bg-[#1A7A64]/60"></div>
                    <div class="absolute left-7 top-3 w-2 h-2 rounded-full bg-[#4ECDC4]/60"></div>
                    <div class="absolute right-0 top-0 w-2 h-2 rounded-full bg-[#1A7A64]/60"></div>
                </div>
            </div>
        </div>

        {sortedCategories.map((category) => (
            <div class="mb-16">
                <div class="text-center mb-10">
                    <h3 class="inline-block px-8 py-2 bg-gradient-to-r from-[#1A7A64] to-[#0D3B66] text-white rounded-full shadow-md text-lg font-semibold">
                        {category}
                    </h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {groupedMembers[category].map((member, index) => (
                        <div class="committee-member bg-white rounded-xl overflow-hidden shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group">
                            <div class="relative h-64 overflow-hidden">
                                <!-- Top color accent -->
                                <div class="absolute top-0 left-0 w-full h-2 bg-[#1A7A64] z-10"></div>

                                <!-- Member image with gradient overlay -->
                                <div class="absolute inset-0 bg-gradient-to-b from-black/5 to-black/60"></div>
                                <img
                                    src={member.image && imageExists(member.image) ? member.image : defaultAvatar}
                                    alt={member.name}
                                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                    loading="lazy"
                                />

                                <!-- Country flag if available -->
                                {member.country && (
                                    <div class="absolute top-3 right-3 w-8 h-8 rounded-full overflow-hidden border-2 border-white shadow-md">
                                        <img
                                            src={`/src/assets/flags/${member.country.toLowerCase()}.svg`}
                                            alt={`${member.country} flag`}
                                            class="w-full h-full object-cover"
                                        />
                                    </div>
                                )}

                                <!-- Member info overlay -->
                                <div class="absolute inset-x-0 bottom-0 p-4 text-white">
                                    <h4 class="text-xl font-bold truncate group-hover:text-[#4ECDC4] transition-colors">
                                        {member.name}
                                    </h4>
                                    {member.title && (
                                        <p class="text-sm text-white/90 truncate">{member.title}</p>
                                    )}
                                    {member.affiliation && (
                                        <p class="text-xs text-white/80 truncate mt-1">{member.affiliation}</p>
                                    )}
                                </div>
                            </div>

                            <div class="p-4 bg-white">
                                {member.role && (
                                    <div class="mb-2">
                                        <span class="inline-block px-3 py-1 bg-[#1A7A64]/10 text-[#1A7A64] text-xs font-semibold rounded-full">
                                            {member.role}
                                        </span>
                                    </div>
                                )}

                                <!-- Contact info with animated reveal on hover -->
                                <div class="mt-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    {member.email && (
                                        <a href={`mailto:${member.email}`} class="flex items-center text-sm text-slate-600 hover:text-[#1A7A64]">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                            </svg>
                                            Contact
                                        </a>
                                    )}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        ))}
    </div>
</section>

<style>
    .committee-member {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* Staggered hover effect for grid items */
    @media (min-width: 768px) {
        .committee-member:nth-child(odd):hover {
            transform: translateY(-6px);
        }

        .committee-member:nth-child(even):hover {
            transform: translateY(-6px);
        }
    }

    /* Committee section specific animations */
    @keyframes fade-in-up {
        0% {
            opacity: 0;
            transform: translateY(20px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .committee-member {
        animation: fade-in-up 0.6s ease-out;
        animation-fill-mode: both;
    }

    .committee-member:nth-child(1) { animation-delay: 0.1s; }
    .committee-member:nth-child(2) { animation-delay: 0.2s; }
    .committee-member:nth-child(3) { animation-delay: 0.3s; }
    .committee-member:nth-child(4) { animation-delay: 0.4s; }
    .committee-member:nth-child(5) { animation-delay: 0.5s; }
    .committee-member:nth-child(6) { animation-delay: 0.6s; }
    /* Continue for more items as needed */

    /* Shadow effect for category badges */
    h3.inline-block {
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    /* Enhance accessibility */
    @media (prefers-reduced-motion: reduce) {
        .committee-member {
            animation: none;
        }
    }
</style>
