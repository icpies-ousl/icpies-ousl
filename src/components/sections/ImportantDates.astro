---
interface DateItem {
    event: string;
    date: string;
    isPassed?: boolean;
    isHighlighted?: boolean;
}

interface Props {
    title: string;
    subtitle?: string;
    dates: DateItem[];
}

const { title, subtitle, dates } = Astro.props;

// Helper to check if a date has passed
const isDatePassed = (dateStr: string) => {
    const today = new Date();
    const itemDate = new Date(dateStr);
    return today > itemDate;
};

// Process dates and add status
const processedDates = dates.map(date => ({
    ...date,
    isPassed: date.isPassed !== undefined ? date.isPassed : isDatePassed(date.date)
}));

// Group dates by month for visual organization
const groupedDates = processedDates.reduce((acc, date) => {
    const month = new Date(date.date).toLocaleString('default', { month: 'long', year: 'numeric' });
    if (!acc[month]) {
        acc[month] = [];
    }
    acc[month].push(date);
    return acc;
}, {} as Record<string, DateItem[]>);
---

<div class="py-16 bg-[#F7F7F7] rounded-xl" id="important-dates">
    <div class="max-w-4xl mx-auto px-4">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold text-[#2C3E50] mb-3">{title}</h2>
            <div class="w-24 h-1 bg-[#1A7A64] rounded-full mx-auto mb-4 opacity-60"></div>
            {subtitle && <p class="text-lg text-[#2C3E50]/80">{subtitle}</p>}
        </div>

        <div class="timeline-container relative">
            <!-- Timeline line -->
            <div class="absolute left-1/2 transform -translate-x-1/2 h-full w-1 bg-gradient-to-b from-[#1A7A64]/50 to-[#0D3B66]/50 rounded opacity-30"></div>

            <!-- Timeline content -->
            <div class="relative z-10">
                {Object.entries(groupedDates).map(([month, monthDates], monthIndex) => (
                    <div class="mb-8">
                        <div class="flex justify-center">
                            <div class="month-marker py-2 px-6 bg-gradient-to-r from-[#1A7A64] to-[#0D3B66] text-white rounded-full shadow-md text-sm font-medium mb-6">
                                {month}
                            </div>
                        </div>

                        <div class="space-y-6">
                            {monthDates.map((dateItem, index) => (
                                <div class={`date-item flex flex-col md:flex-row items-center ${index % 2 === 0 ? 'md:flex-row-reverse' : ''}`}>
                                    <!-- Date -->
                                    <div class="date-side w-full md:w-1/2 px-4 flex md:justify-end">
                                        <div class={`date-badge px-4 py-2 rounded-lg shadow-md ${dateItem.isPassed ? 'bg-[#2C3E50]/10 text-[#2C3E50]/60' : 'bg-gradient-to-r from-[#FF9F1C]/80 to-[#FF9F1C] text-white'} ${dateItem.isHighlighted ? 'border-2 border-[#FF9F1C]' : ''} inline-block`}>
                                            <span class="font-bold">{new Date(dateItem.date).toLocaleDateString('default', { day: '2-digit' })}</span>
                                            <span class="text-sm">{new Date(dateItem.date).toLocaleDateString('default', { month: 'short' })}</span>
                                        </div>
                                    </div>

                                    <!-- Timeline dot -->
                                    <div class="timeline-dot relative">
                                        <div class={`absolute left-1/2 transform -translate-x-1/2 w-5 h-5 rounded-full border-4 ${dateItem.isPassed ? 'bg-[#2C3E50]/30 border-[#2C3E50]/20' : dateItem.isHighlighted ? 'bg-[#FF9F1C] border-[#FF9F1C]/30 animate-pulse' : 'bg-[#1A7A64] border-[#4ECDC4]/30'}`}></div>
                                    </div>

                                    <!-- Event -->
                                    <div class="event-side w-full md:w-1/2 px-4">
                                        <div class={`event-card p-5 rounded-xl shadow-sm transition-all ${dateItem.isPassed ? 'bg-white/50' : 'bg-white hover:shadow-md'} ${dateItem.isHighlighted ? 'border-l-4 border-[#FF9F1C]' : ''}`}>
                                            <h3 class={`font-semibold text-lg ${dateItem.isPassed ? 'text-[#2C3E50]/60' : dateItem.isHighlighted ? 'text-[#FF9F1C]' : 'text-[#1A7A64]'}`}>
                                                {dateItem.event}
                                            </h3>
                                            <p class={`text-sm ${dateItem.isPassed ? 'text-[#2C3E50]/40' : 'text-[#2C3E50]/70'}`}>
                                                {new Date(dateItem.date).toLocaleDateString('default', { month: 'long', day: 'numeric', year: 'numeric' })}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                ))}
            </div>
        </div>

        <!-- Legend -->
        <div class="mt-12 flex flex-wrap justify-center gap-6 text-sm text-[#2C3E50]/80">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-[#1A7A64] border-2 border-[#4ECDC4]/30"></div>
                <span>Upcoming</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-[#FF9F1C] border-2 border-[#FF9F1C]/30 animate-pulse"></div>
                <span>Current Focus</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-[#2C3E50]/30 border-2 border-[#2C3E50]/20"></div>
                <span>Past Date</span>
            </div>
        </div>
    </div>
</div>

<style>
    .timeline-container {
        padding: 2rem 0;
    }

    .date-item {
        margin-bottom: 2rem;
        position: relative;
    }

    .timeline-dot {
        min-width: 30px;
        min-height: 30px;
        margin: 1rem 0;
    }

    @media (max-width: 768px) {
        .date-side, .event-side {
            width: 100%;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .timeline-dot {
            margin: 0.5rem 0;
        }

        .date-badge {
            margin: 0 auto;
        }
    }

    /* Animation for highlighted dates */
    @keyframes pulse-subtle {
        0%, 100% {
            box-shadow: 0 0 0 0 rgba(255, 159, 28, 0.4);
        }
        50% {
            box-shadow: 0 0 0 10px rgba(255, 159, 28, 0);
        }
    }

    .animate-pulse {
        animation: pulse-subtle 2s infinite;
    }
</style>
